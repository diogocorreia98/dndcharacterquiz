{
  "root": "q_gender",
  "nodes": {
    "q_gender": {
      "type": "question",
      "section": "gender",
      "question": "My character presents as which gender?",
      "options": [
        {
          "value": "A",
          "set": [
            {
              "var": "gender",
              "op": "set",
              "value": "A"
            }
          ],
          "next": "q_height"
        },
        {
          "value": "B",
          "set": [
            {
              "var": "gender",
              "op": "set",
              "value": "B"
            }
          ],
          "next": "q_height"
        },
        {
          "value": "C",
          "set": [
            {
              "var": "gender",
              "op": "set",
              "value": "C"
            }
          ],
          "next": "q_height"
        }
      ]
    },
    "q_height": {
      "type": "question",
      "section": "species",
      "question": "My character is roughly what height?",
      "options": [
        {
          "value": "A",
          "set": [
            {
              "var": "height",
              "op": "set",
              "value": "A"
            }
          ],
          "next": "q_species_exoticness"
        },
        {
          "value": "B",
          "set": [
            {
              "var": "height",
              "op": "set",
              "value": "B"
            }
          ],
          "next": "q_species_exoticness"
        },
        {
          "value": "C",
          "set": [
            {
              "var": "height",
              "op": "set",
              "value": "C"
            }
          ],
          "next": "q_species_exoticness"
        },
        {
          "value": "D",
          "set": [
            {
              "var": "height",
              "op": "set",
              "value": "D"
            }
          ],
          "next": "q_species_exoticness"
        }
      ]
    },
    "q_species_exoticness": {
      "type": "question",
      "section": "species",
      "question": "My character comes from a species that is how familiar?",
      "prune_zero_viable_options": {
        "dataset": "species",
        "option_field": "species_commonality",
        "filters": [
          {
            "field": "height",
            "var": "height",
            "op": "contains",
            "optional": false
          }
        ],
        "exclude_values": [
          "A"
        ]
      },
      "options": [
        {
          "value": "A",
          "set": [
            {
              "var": "species_commonality",
              "op": "set",
              "value": "A"
            },
            {
              "var": "species",
              "op": "set",
              "value": "A"
            }
          ],
          "next": "q_primary_roles"
        },
        {
          "value": "B",
          "set": [
            {
              "var": "species_commonality",
              "op": "set",
              "value": "B"
            }
          ],
          "next": "q_species_animal_likeness"
        },
        {
          "value": "C",
          "set": [
            {
              "var": "species_commonality",
              "op": "set",
              "value": "C"
            }
          ],
          "next": "q_species_animal_likeness"
        },
        {
          "value": "D",
          "set": [
            {
              "var": "species_commonality",
              "op": "set",
              "value": "D"
            }
          ],
          "next": "q_species_animal_likeness"
        }
      ]
    },
    "q_species_animal_likeness": {
      "type": "question",
      "section": "species",
      "question": "My character shows animal traits, yes or no?",
      "prune_zero_viable_options": {
        "dataset": "species",
        "option_field": "animal_likeness",
        "filters": [
          {
            "field": "height",
            "var": "height",
            "op": "contains",
            "optional": false
          },
          {
            "field": "species_commonality",
            "var": "species_commonality",
            "op": "contains",
            "optional": false
          }
        ]
      },
      "options": [
        {
          "value": "A",
          "set": [
            {
              "var": "animal_likeness",
              "op": "set",
              "value": "A"
            }
          ],
          "next": "q_species_pick"
        },
        {
          "value": "B",
          "set": [
            {
              "var": "animal_likeness",
              "op": "set",
              "value": "B"
            }
          ],
          "next": "q_species_pick"
        }
      ]
    },
    "q_species_pick": {
      "type": "question",
      "section": "species",
      "question": "My character is what species?",
      "options_source": {
        "type": "inline",
        "dataset": "species",
        "label_field": "pt",
        "value_field": "code",
        "filters": [
          {
            "field": "height",
            "var": "height",
            "op": "contains",
            "optional": true
          },
          {
            "field": "species_commonality",
            "var": "species_commonality",
            "op": "contains",
            "optional": true
          },
          {
            "field": "animal_likeness",
            "var": "animal_likeness",
            "op": "contains",
            "optional": true
          }
        ]
      },
      "autoselect_if_single": {
        "dataset": "species",
        "filters": [
          {
            "field": "height",
            "var": "height",
            "op": "contains",
            "optional": true
          },
          {
            "field": "species_commonality",
            "var": "species_commonality",
            "op": "contains",
            "optional": true
          },
          {
            "field": "animal_likeness",
            "var": "animal_likeness",
            "op": "contains",
            "optional": true
          }
        ],
        "value_field": "code",
        "set": [
          {
            "var": "species",
            "op": "set",
            "value_from_result": true
          },
          {
            "var": "subspecies",
            "op": "set",
            "value": null
          },
          {
            "var": "subsubspecies",
            "op": "set",
            "value": null
          },
          {
            "var": "goliath_power_type",
            "op": "set",
            "value": null
          },
          {
            "var": "dragonborn_ancestry_type",
            "op": "set",
            "value": null
          }
        ],
        "skip_to": "q_dragonborn_ancestry_type"
      },
      "on_select": [
        {
          "var": "species",
          "op": "set",
          "value_from_option": true
        },
        {
          "var": "subspecies",
          "op": "set",
          "value": null
        },
        {
          "var": "subsubspecies",
          "op": "set",
          "value": null
        },
        {
          "var": "goliath_power_type",
          "op": "set",
          "value": null
        },
        {
          "var": "dragonborn_ancestry_type",
          "op": "set",
          "value": null
        }
      ],
      "next": "q_dragonborn_ancestry_type"
    },
    "q_dragonborn_ancestry_type": {
      "type": "question",
      "section": "species",
      "question": "My character is defined by which draconic ancestry?",
      "when": {
        "var": "species",
        "op": "eq",
        "value": "S007"
      },
      "options": [
        {
          "value": "chromatic",
          "set": [
            {
              "var": "dragonborn_ancestry_type",
              "op": "set",
              "value": "chromatic"
            }
          ],
          "next": "q_goliath_power_type"
        },
        {
          "value": "metallic",
          "set": [
            {
              "var": "dragonborn_ancestry_type",
              "op": "set",
              "value": "metallic"
            }
          ],
          "next": "q_goliath_power_type"
        }
      ],
      "next": "q_goliath_power_type"
    },
    "q_goliath_power_type": {
      "type": "question",
      "section": "species",
      "question": "My character draws on which giant-ancestry power?",
      "when": {
        "var": "species",
        "op": "eq",
        "value": "S017"
      },
      "options": [
        {
          "value": "defensive",
          "set": [
            {
              "var": "goliath_power_type",
              "op": "set",
              "value": "defensive"
            }
          ],
          "next": "q_subspecies_pick"
        },
        {
          "value": "mobility",
          "set": [
            {
              "var": "goliath_power_type",
              "op": "set",
              "value": "mobility"
            }
          ],
          "next": "q_subspecies_pick"
        },
        {
          "value": "offensive",
          "set": [
            {
              "var": "goliath_power_type",
              "op": "set",
              "value": "offensive"
            }
          ],
          "next": "q_subspecies_pick"
        }
      ],
      "next": "q_subspecies_pick"
    },
    "q_subspecies_pick": {
      "type": "question",
      "section": "species",
      "question": "My character is from which sub-species?",
      "when": {
        "var": "species",
        "op": "in",
        "value": [
          "S006",
          "S007",
          "S008",
          "S009",
          "S012",
          "S013",
          "S014",
          "S015",
          "S017",
          "S019",
          "S024",
          "S026",
          "S030",
          "S032"
        ]
      },
      "options_source": {
        "type": "inline",
        "dataset": "subspecies",
        "label_field": "pt",
        "value_field": "code",
        "filters": [
          {
            "field": "species_code",
            "var": "species",
            "op": "eq",
            "optional": false
          },
          {
            "field": "species_commonality",
            "var": "species_commonality",
            "op": "contains",
            "optional": false
          },
          {
            "field": "height",
            "var": "height",
            "op": "contains",
            "optional": true
          },
          {
            "field": "animal_likeness",
            "var": "animal_likeness",
            "op": "contains",
            "optional": true
          },
          {
            "field": "goliath_power_type",
            "var": "goliath_power_type",
            "op": "contains",
            "optional": true
          },
          {
            "field": "dragonborn_ancestry_type",
            "var": "dragonborn_ancestry_type",
            "op": "contains",
            "optional": true
          }
        ]
      },
      "skip_if_no_options": {
        "next": "q_primary_roles"
      },
      "autoselect_if_single": {
        "dataset": "subspecies",
        "filters": [
          {
            "field": "species_code",
            "var": "species",
            "op": "eq",
            "optional": false
          },
          {
            "field": "species_commonality",
            "var": "species_commonality",
            "op": "contains",
            "optional": false
          },
          {
            "field": "height",
            "var": "height",
            "op": "contains",
            "optional": true
          },
          {
            "field": "animal_likeness",
            "var": "animal_likeness",
            "op": "contains",
            "optional": true
          },
          {
            "field": "goliath_power_type",
            "var": "goliath_power_type",
            "op": "contains",
            "optional": true
          },
          {
            "field": "dragonborn_ancestry_type",
            "var": "dragonborn_ancestry_type",
            "op": "contains",
            "optional": true
          }
        ],
        "value_field": "code",
        "set": [
          {
            "var": "subspecies",
            "op": "set",
            "value_from_result": true
          },
          {
            "var": "subsubspecies",
            "op": "set",
            "value": null
          }
        ],
        "skip_to": "q_subsubspecies_pick"
      },
      "on_select": [
        {
          "var": "subspecies",
          "op": "set",
          "value_from_option": true
        },
        {
          "var": "subsubspecies",
          "op": "set",
          "value": null
        }
      ],
      "next": "q_subsubspecies_pick"
    },
    "q_subsubspecies_pick": {
      "type": "question",
      "section": "species",
      "question": "My character belongs to which specific variation of that sub-species?",
      "options_source": {
        "type": "inline",
        "dataset": "subsubspecies",
        "label_field": "pt",
        "value_field": "code",
        "filters": [
          {
            "field": "subspecies_code",
            "var": "subspecies",
            "op": "eq",
            "optional": false
          },
          {
            "field": "height",
            "var": "height",
            "op": "contains",
            "optional": true
          },
          {
            "field": "animal_likeness",
            "var": "animal_likeness",
            "op": "contains",
            "optional": true
          }
        ]
      },
      "skip_if_no_options": {
        "next": "q_primary_roles"
      },
      "autoselect_if_single": {
        "dataset": "subsubspecies",
        "filters": [
          {
            "field": "subspecies_code",
            "var": "subspecies",
            "op": "eq",
            "optional": false
          },
          {
            "field": "height",
            "var": "height",
            "op": "contains",
            "optional": true
          },
          {
            "field": "animal_likeness",
            "var": "animal_likeness",
            "op": "contains",
            "optional": true
          }
        ],
        "value_field": "code",
        "set": [
          {
            "var": "subsubspecies",
            "op": "set",
            "value_from_result": true
          }
        ],
        "skip_to": "q_primary_roles"
      },
      "on_select": [
        {
          "var": "subsubspecies",
          "op": "set",
          "value_from_option": true
        }
      ],
      "next": "q_primary_roles"
    }
  }
}
